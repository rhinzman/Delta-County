<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delta County GIS App</title>

    <!-- ArcGIS API for JavaScript CSS -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
    <link rel="stylesheet" href="styles.css">

    <!-- ArcGIS API for JavaScript -->
    <script src="https://js.arcgis.com/4.25/"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Delta County GIS Application</h1>
            <p>Interactive map of Delta County, Michigan</p>
        </div>
    </header>
    
    <main>
        <div id="map-container">
            <!-- viewDiv is required by the ArcGIS API for JavaScript MapView -->
            <div id="viewDiv"></div>
        </div>
        
        <!-- Field Collection Button -->
        <a href="https://fieldmaps.arcgis.app/?itemID=4276a0e0d3c945bb821df31742b254de&referenceContext=open&portalURL=https%3A%2F%2Fuw-mad.maps.arcgis.com" 
           target="_blank"
           class="field-collection-btn" 
           title="Open Field Collection App">
            ðŸ“± Field Collection
        </a>

        <script>
            require([
                "esri/config",
                "esri/Map",
                "esri/views/MapView",
                "esri/layers/FeatureLayer",
                "esri/renderers/SimpleRenderer",
                "esri/symbols/SimpleFillSymbol",
                "esri/symbols/SimpleLineSymbol",
                "esri/symbols/SimpleMarkerSymbol"
            ], function(esriConfig, Map, MapView, FeatureLayer, SimpleRenderer, SimpleFillSymbol, SimpleLineSymbol, SimpleMarkerSymbol) {
                // set portal
                esriConfig.portalUrl = "https://uw-mad.maps.arcgis.com";

                // create a map with basemap
                const map = new Map({
                    basemap: "streets"
                });

                // Townships layer
                const townshipsLayer = new FeatureLayer({
                    portalItem: {
                        id: "d915eed690bc40b280e02fe937bc2144"
                    },
                    layerId: 7,
                    title: "Townships",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleFillSymbol({
                            color: null,
                            outline: new SimpleLineSymbol({
                                color: "lightblue",
                                width: 2
                            })
                        })
                    })
                });
                map.add(townshipsLayer);

                // Parcels layer
                const parcelsLayer = new FeatureLayer({
                    portalItem: {
                        id: "3ffcda2f2e2647889ffaec5e19ea766d"
                    },
                    layerId: 2,
                    title: "Delta Parcels",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleFillSymbol({
                            color: null,
                            outline: new SimpleLineSymbol({
                                color: "lightgray",
                                width: 1
                            })
                        })
                    })
                });
                map.add(parcelsLayer);

                // Roads layer
                const roadsLayer = new FeatureLayer({
                    portalItem: {
                        id: "68dcda0490334cb1b1537bb5eabe6c24"
                    },
                    layerId: 1,
                    title: "Roads",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleLineSymbol({
                            color: "darkgray",
                            width: 1.5
                        })
                    })
                });
                map.add(roadsLayer);

                // Address Points layer
                const addressPointsLayer = new FeatureLayer({
                    portalItem: {
                        id: "c6d900ca3cec407ca88a073e16883482"
                    },
                    layerId: 0,
                    title: "Address Points",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            style: "circle",
                            color: "lightgreen",
                            size: 5
                        })
                    })
                });
                map.add(addressPointsLayer);

                const view = new MapView({
                    container: "viewDiv",
                    map: map,
                    center: [-86.8, 45.9], // approximate center of Delta County
                    zoom: 10
                });

                view.when(() => {
                    console.log('Map loaded with layers');
                }, function(error){
                    console.error('Map failed to load:', error);
                });
            });

            // Ensure the button opens in a new tab if JS is enabled
            const fcBtn = document.querySelector('.field-collection-btn');
            if (fcBtn) fcBtn.addEventListener('click', function(event) {
                event.preventDefault();
                window.open(this.href, '_blank');
            });
        </script>
    </main>
    
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Delta County GIS Application | Data from Delta County, Michigan</p>
        </div>
    </footer>
    
</body>
</html>
